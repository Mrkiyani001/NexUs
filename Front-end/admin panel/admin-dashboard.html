<!DOCTYPE html>

<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Admin Dashboard</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#215bed",
                        "background-light": "#f6f6f8",
                        "background-dark": "#101522",
                        "surface-dark": "#1e2330",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "2xl": "2rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        /* Custom scrollbar for webkit */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #101522;
        }

        ::-webkit-scrollbar-thumb {
            background: #2d3748;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4a5568;
        }

        .glass-panel {
            background: rgba(30, 35, 48, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-panel-heavy {
            background: rgba(30, 35, 48, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white antialiased selection:bg-primary selection:text-white overflow-hidden">
    <!-- Background Gradient Effects for depth -->
    <div
        class="fixed top-0 left-0 w-full h-[500px] bg-gradient-to-b from-primary/10 to-transparent pointer-events-none z-0">
    </div>
    <div
        class="fixed -top-[20%] -right-[10%] w-[600px] h-[600px] bg-primary/5 rounded-full blur-3xl pointer-events-none z-0">
    </div>
    <div class="relative flex h-screen w-full overflow-hidden z-10">
        <!-- Sidebar Navigation -->
    <script src="../js/config.js"></script>
    <script src="../js/site_branding.js"></script>
    <script src="../js/admin_utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            renderAdminSidebar('dashboard');
            loadStats();
            loadUsers();
        });

        let ALL_ROLES = [];

        async function fetchAllRoles() {
            try {
                const response = await fetch(`${API_BASE_URL}/get_all_roles`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('auth_token')}` }
                });
                
                if(handleAdminApiError(response)) return;

                const data = await response.json();
                if(data.success) {
                    ALL_ROLES = data.data;
                }
            } catch(e) { console.error("Failed to fetch roles", e); }
        }

        // Call this on init
        document.addEventListener('DOMContentLoaded', () => {
             // ... existing init ...
             fetchAllRoles();
        });

        function openRoleModal(userId, currentRolesString) {
            const modal = document.getElementById('role-modal');
            const list = document.getElementById('role-list');
            document.getElementById('role-user-id').value = userId;
            
            const currentRoles = currentRolesString.toLowerCase().split(',').map(r => r.trim());

            list.innerHTML = ALL_ROLES.map(role => {
                const isChecked = currentRoles.includes(role.name.toLowerCase());
                return `
                <label class="flex items-center justify-between p-3 rounded-xl border border-white/5 bg-white/[0.02] hover:bg-white/5 cursor-pointer transition-colors group">
                    <span class="text-sm font-medium text-slate-300 group-hover:text-white">${role.name}</span>
                    <input type="checkbox" name="roles" value="${role.name}" ${isChecked ? 'checked' : ''} 
                        class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-primary focus:ring-offset-0 focus:ring-0">
                </label>
                `;
            }).join('');

            modal.classList.remove('hidden');
        }

        function closeRoleModal() {
            document.getElementById('role-modal').classList.add('hidden');
        }

        // Mobile Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('admin-sidebar');
            sidebar.classList.toggle('hidden');
            sidebar.classList.toggle('flex');
            sidebar.classList.toggle('absolute');
            sidebar.classList.toggle('inset-0');
            sidebar.classList.toggle('z-50');
            sidebar.classList.toggle('w-full');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            const sidebar = document.getElementById('admin-sidebar');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            // If sidebar is open (not hidden) AND click is NOT on sidebar AND click is NOT on menu toggle
            if (!sidebar.classList.contains('hidden') && 
                !sidebar.contains(e.target) && 
                !menuBtn.contains(e.target) &&
                window.innerWidth < 768) { // Only on mobile
                toggleSidebar();
            }
        });

        // Toast Notification Helper
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-6 right-6 px-6 py-4 rounded-xl backdrop-blur-md shadow-2xl transform transition-all duration-500 translate-y-20 opacity-0 z-50 flex items-center gap-3 border ${type === 'success' ? 'bg-black/80 border-green-500/30' : 'bg-black/80 border-red-500/30'}`;
            toast.innerHTML = `
                <span class="material-symbols-outlined ${type === 'success' ? 'text-green-400' : 'text-red-400'}">
                    ${type === 'success' ? 'check_circle' : 'error'}
                </span>
                <span class="text-white font-medium text-sm">${message}</span>
            `;
            document.body.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('translate-y-20', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        async function submitRoles(e) {
            e.preventDefault();
            const userId = document.getElementById('role-user-id').value;
            const checkboxes = document.querySelectorAll('input[name="roles"]:checked');
            const selectedRoles = Array.from(checkboxes).map(cb => cb.value);

            // If empty, maybe warn? or allow clearing roles (assigning empty array)
            // But usually 'User' role is default. Let's just submit specific roles.

            try {
                const response = await fetch(`${API_BASE_URL}/role/assign_role`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('auth_token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        role: selectedRoles // Array
                    })
                });

                if(handleAdminApiError(response)) return;

                const data = await response.json();
                
                if(data.success) {
                    closeRoleModal();
                    loadUsers(); // Refresh table
                    alert('Roles updated successfully');
                } else {
                    alert('Failed: ' + data.message);
                }
            } catch(e) {
                console.error(e);
                alert('Error updating roles');
            }
        }

        let isFetchingStats = false;
        async function loadStats(isAutoRefresh = false) {
            if(isFetchingStats) return;
            isFetchingStats = true;

            const cacheKey = 'admin_stats_cache';
            
            // 1. Valid Cache (Initial)
            const cached = localStorage.getItem(cacheKey);
            if (!isAutoRefresh && cached) {
                 try {
                    const parsed = JSON.parse(cached);
                    if (parsed) renderStats(parsed);
                } catch(e) { console.error("Cache parse error", e); }
            }

            try {
                console.log('Fetching Stats from:', `${API_BASE_URL}/admin/stats`);
                const response = await fetch(`${API_BASE_URL}/admin/stats`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('auth_token')}` }
                });

                console.log('Stats Response Status:', response.status);

                if(handleAdminApiError(response)) return;

                const text = await response.text();
                // console.log('Stats Raw Response:', text); // Uncomment if needed

                let data;
                try {
                    data = JSON.parse(text);
                } catch(e) {
                    console.error("JSON Parse Error. Raw text:", text);
                    console.log("Response text start:", text.substring(0, 100)); // Log first 100 chars
                    return; // Stop here
                }

                if (data.success) {
                    console.log('Stats Data Success:', data.data);
                    const stats = data.data;
                    const newDataStr = JSON.stringify(stats);
                    const oldDataStr = localStorage.getItem(cacheKey);

                    if (newDataStr !== oldDataStr) {
                         localStorage.setItem(cacheKey, newDataStr);
                         renderStats(stats);
                    } else {
                         // Force render even if cache matches, just in case DOM was empty
                         renderStats(stats);
                    }
                } else {
                    console.error('Stats API returned success: false', data);
                }
            } catch (e) { 
                console.error("loadStats Error:", e);
            }
            finally { isFetchingStats = false; }
        }

        function renderStats(stats) {
            updateStatCard('total-users-count', stats.total_users);
            updateStatCard('new-users-count', stats.new_users_today, `+${stats.growth_percentage}% vs yesterday`);
            updateStatCard('banned-users-count', stats.banned_users);
        }

        // Recursive Polling for Stats
        async function startStatsPolling() {
            await loadStats(true);
            setTimeout(startStatsPolling, 3000);
        }
        startStatsPolling();

        function updateStatCard(id, value, subtext = '') {
            const el = document.getElementById(id);
            if(el) el.textContent = value;
            // Optionally update subtext if I add IDs for them
        }

        let currentFilter = 'all';
        let currentSearch = '';
        let timer;

        // Debounce search
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(timer);
                    currentSearch = e.target.value.trim();
                    console.log('Search Input:', currentSearch); // Debug log
                    timer = setTimeout(() => {
                        console.log('Triggering loadUsers with search:', currentSearch); // Debug log
                        loadUsers(1);
                    }, 500);
                });
            } else {
                console.error('Search Input element not found!');
            }
        });

        function setFilter(filter) {
            currentFilter = filter;
            // Update UI
            ['all', 'admins', 'moderators', 'banned', 'active'].forEach(f => {
                const btn = document.getElementById(`btn-filter-${f}`);
                if(f === filter) {
                    btn.className = "px-4 py-2 rounded-lg bg-primary text-white text-sm font-bold shadow-lg shadow-blue-500/20 transition-all";
                } else {
                    btn.className = "px-4 py-2 rounded-lg hover:bg-white/5 text-slate-400 hover:text-white text-sm font-medium transition-all";
                }
            });
            loadUsers(1);
        }

        async function loadUsers(page = 1) {
            const tableBody = document.getElementById('user-table-body');
            tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-20 text-center text-slate-500">Loading users...</td></tr>`;

            try {
                let url;
                let options = {
                    headers: { 
                        'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
                    }
                };

                if (currentSearch) {
                    url = `${API_BASE_URL}/search_user?page=${page}`; 
                    options.method = 'POST';
                    options.headers['Content-Type'] = 'application/json';
                    options.body = JSON.stringify({
                        search: currentSearch,
                        limit: currentLimit
                    });
                } else if (currentFilter !== 'all') {
                    url = `${API_BASE_URL}/filter_users?page=${page}&limit=${currentLimit}&filter=${currentFilter}`;
                    options.method = 'GET';
                } else {
                    url = `${API_BASE_URL}/getallusers?page=${page}&limit=${currentLimit}`;
                    options.method = 'GET';
                }

                console.log('Fetching Users:', url, options); // Debugging

                const response = await fetch(url, options);
                
                if(handleAdminApiError(response)) return;

                // Check if response is ok (status 200-299)
                // Check if response is ok (status 200-299)
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({})); // Safely try to parse JSON
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    renderUserTable(data.data.items);
                    renderPagination(data.data.pagination);
                } else {
                     tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-20 text-center text-slate-500">${data.message || 'No users found.'}</td></tr>`;
                     document.getElementById('pagination-footer').innerHTML = '';
                }
            } catch (e) {
                console.error(e);
                tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-20 text-center text-red-500">Error loading users.</td></tr>`;
            }
        }

        async function banUser(userId, currentStatus) {
            const action = currentStatus === 1 ? 'unban' : 'ban';
            if(!confirm(`Are you sure you want to ${action} this user?`)) return;

            try {
                const response = await fetch(`${API_BASE_URL}/admin/ban_user`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('auth_token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: userId, action: action })
                });

                if(handleAdminApiError(response)) return;

                const data = await response.json();
                if(data.success) {
                    // alert(`User ${action}ned successfully`);
                    loadUsers(); // Refresh table
                    loadStats(); // Refresh stats
                } else {
                    alert('Action failed: ' + data.message);
                }
            } catch(e) { console.error(e); }
        }

        function renderUserTable(users) {
            const tableBody = document.getElementById('user-table-body');
            tableBody.innerHTML = '';

            users.forEach(user => {
                const roles = (user.roles || []).map(r => typeof r === 'object' ? r.name : r).join(', ');
                const initials = (user.name || 'U')[0].toUpperCase();
                
                // Fix for avatar handling (might be object or string)
                let avatarPath = null;
                if (user.profile && user.profile.avatar) {
                    if (typeof user.profile.avatar === 'object') {
                         avatarPath = user.profile.avatar.file_path || user.profile.avatar.file_name;
                    } else {
                         avatarPath = user.profile.avatar;
                    }
                }

                const avatar = avatarPath 
                    ? `${PUBLIC_URL}/${avatarPath}` 
                    : `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=2d3748&color=fff`;
                
                const joinedDate = new Date(user.created_at).toLocaleDateString();

                const isBanned = user.is_banned === 1;
                const statusHtml = isBanned 
                    ? `<span class="text-red-400 font-medium bg-red-500/10 px-2 py-1 rounded-md">Banned</span>`
                    : `<span class="text-emerald-400 font-medium bg-emerald-500/10 px-2 py-1 rounded-md">Active</span>`;
                
                const banBtnTitle = isBanned ? "Unban User" : "Ban User";
                const banBtnIcon = isBanned ? "check_circle" : "block"; 
                const banBtnClass = isBanned ? "hover:bg-emerald-500/20 hover:text-emerald-400" : "hover:bg-red-500/20 hover:text-red-400";

                tableBody.innerHTML += `
                    <tr class="group hover:bg-white/[0.03] transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-3">
                                <img src="${avatar}" class="size-10 rounded-full border border-white/10 object-cover bg-slate-700" 
                                     onerror="this.src='https://ui-avatars.com/api/?name=${initials}&background=2d3748&color=fff'">
                                <div class="flex flex-col">
                                    <span class="font-semibold text-white">${user.name}</span>
                                    <span class="text-slate-500 text-xs">${user.email}</span>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold ${getRoleClass(roles)}">
                                ${roles || 'User'}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            ${statusHtml}
                        </td>
                        <td class="px-6 py-4 text-slate-400">${joinedDate}</td>
                        <td class="px-6 py-4 text-right">
                            <div class="flex items-center justify-end gap-2 opacity-60 group-hover:opacity-100 transition-opacity">
                                <button onclick="window.location.href='../profile.html?id=${user.id}'" class="p-2 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white transition-colors" title="View Profile">
                                    <span class="material-symbols-outlined text-[20px]">visibility</span>
                                </button>
                                <button onclick='openRoleModal(${user.id}, "${roles}")' class="p-2 rounded-lg hover:bg-blue-500/20 text-slate-400 hover:text-blue-400 transition-colors" title="Manage Roles">
                                    <span class="material-symbols-outlined text-[20px]">shield_person</span>
                                </button>
                                <button onclick="banUser(${user.id}, ${user.is_banned || 0})" class="p-2 rounded-lg ${banBtnClass} text-slate-400 transition-colors" title="${banBtnTitle}">
                                    <span class="material-symbols-outlined text-[20px]">${banBtnIcon}</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        function getRoleClass(role) {
            role = role.toLowerCase();
            if (role.includes('admin')) return 'bg-amber-500/20 text-amber-300 border border-amber-500/20';
            if (role.includes('moderator')) return 'bg-purple-500/20 text-purple-300 border border-purple-500/20';
            return 'bg-blue-500/10 text-blue-300 border border-blue-500/10';
        }

        let currentLimit = 10; // Global limit variable

        function renderPagination(pagination) {
            const footer = document.getElementById('pagination-footer');
            const { current_page, total_pages, total, from, to } = pagination;
            
            footer.innerHTML = `
                <div class="flex items-center gap-4 text-sm text-slate-500">
                    <div>
                        Showing <span class="text-white font-semibold">${from || 0}-${to || 0}</span> of <span class="text-white font-semibold">${total}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span>Rows per page:</span>
                        <select onchange="updateLimit(this.value)" class="bg-[#1e2330] border border-white/10 text-white text-xs rounded-lg px-2 py-1 focus:ring-1 focus:ring-primary outline-none">
                            <option value="10" ${currentLimit == 10 ? 'selected' : ''}>10</option>
                            <option value="20" ${currentLimit == 20 ? 'selected' : ''}>20</option>
                            <option value="50" ${currentLimit == 50 ? 'selected' : ''}>50</option>
                            <option value="100" ${currentLimit == 100 ? 'selected' : ''}>100</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="loadUsers(${current_page - 1})" ${current_page === 1 ? 'disabled' : ''} 
                            class="p-2 rounded-lg hover:bg-white/10 text-slate-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <span class="material-symbols-outlined text-[20px]">chevron_left</span>
                    </button>
                    <span class="text-white text-sm font-bold bg-primary px-3 py-1 rounded-lg">${current_page}</span>
                    <button onclick="loadUsers(${current_page + 1})" ${current_page === total_pages ? 'disabled' : ''}
                            class="p-2 rounded-lg hover:bg-white/10 text-slate-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <span class="material-symbols-outlined text-[20px]">chevron_right</span>
                    </button>
                </div>
            `;
        }
        
        function updateLimit(newLimit) {
            currentLimit = parseInt(newLimit);
            loadUsers(1); // Reset to page 1
        }
    </script>
        <aside id="admin-sidebar" class="hidden md:flex flex-col w-72 h-full glass-panel-heavy border-r border-white/5 z-20 shrink-0">
            <!-- Brand / Profile Header -->
            <div class="p-6 border-b border-white/5">
                <div class="flex items-center gap-4">
                    <div class="relative group cursor-pointer">
                        <div class="bg-center bg-no-repeat bg-cover rounded-full size-12 ring-2 ring-primary/30 group-hover:ring-primary transition-all duration-300"
                            data-alt="Admin profile picture with abstract gradient background"
                            style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuC9ol4QvypCXhFeEoydaVQ6_0BzkQLo0XTsB8vArMey0nvcJOJuGSfwgI4rbqF0LKkQevMdCY4NEHxeuEvGQDY7U4h_bPJrIusp4MJXWTKTWXN6oKggdRNXurKjqhbVGIx5zNx1kVArsZiBIrediGs1-dZxnyxKS6Vkm0-WL14gd6uXmooM8gQe-JOXgRq7qjQAhCyqUUwtQYuluuNR9lHdAMyUS_S8SvKgcIJYHj2JlmxAR1db0JN2bHre2n_KBUJ3EA7x2MM4JWs");'>
                        </div>
                        <div
                            class="absolute bottom-0 right-0 size-3 bg-green-500 border-2 border-[#1e2330] rounded-full">
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-white text-base font-bold leading-tight tracking-tight">Admin Panel</h1>
                        <p class="text-slate-400 text-xs font-medium">Super Admin</p>
                    </div>
                </div>
            </div>
            <!-- Navigation Links -->
            <nav class="flex-1 flex flex-col gap-2 p-4 overflow-y-auto">
                <div class="px-3 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider">Menu</div>
                <a class="flex items-center gap-3 px-4 py-3 rounded-xl bg-primary/15 text-primary border border-primary/10 shadow-[0_0_15px_rgba(33,91,237,0.15)] group transition-all"
                    href="#">
                    <span class="material-symbols-outlined group-hover:scale-110 transition-transform"
                        style="font-variation-settings: 'FILL' 1;">group</span>
                    <span class="text-sm font-semibold">Users</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all group"
                    href="#">
                    <span
                        class="material-symbols-outlined group-hover:scale-110 transition-transform">shield_person</span>
                    <span class="text-sm font-medium">Moderation Queue</span>
                    <span
                        class="ml-auto bg-red-500/20 text-red-400 text-[10px] font-bold px-2 py-0.5 rounded-full border border-red-500/20">12</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all group"
                    href="#">
                    <span class="material-symbols-outlined group-hover:scale-110 transition-transform">flag</span>
                    <span class="text-sm font-medium">Reports</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all group"
                    href="analytics.html">
                    <span class="material-symbols-outlined group-hover:scale-110 transition-transform">analytics</span>
                    <span class="text-sm font-medium">Analytics</span>
                </a>
                <div class="mt-6 px-3 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider">System</div>
                <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-primary/15 text-primary border border-primary/10 transition-all">
                    <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">dashboard</span> <span class="text-sm font-semibold">Dashboard</span>
                </a>
                <a href="admin-roles.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all">
                    <span class="material-symbols-outlined">manage_accounts</span> <span class="text-sm font-medium">Roles & Permissions</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all group"
                    href="#">
                    <span class="material-symbols-outlined group-hover:scale-110 transition-transform">settings</span>
                    <span class="text-sm font-medium">Settings</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all group"
                    href="#">
                    <span class="material-symbols-outlined group-hover:scale-110 transition-transform">help</span>
                    <span class="text-sm font-medium">Support</span>
                </a>
                <a href="../homefeed-dashboard.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all group mt-auto mb-4 border-t border-white/5 pt-4">
                    <span class="material-symbols-outlined group-hover:scale-110 transition-transform">arrow_back</span>
                    <span class="text-sm font-medium">Back to Home</span>
                </a>
            </nav>
            <!-- Bottom Action -->
            <div class="p-4 border-t border-white/5">
                <button
                    class="flex items-center justify-center w-full gap-2 px-4 py-3 rounded-xl text-slate-400 hover:text-red-400 hover:bg-red-500/10 transition-all text-sm font-medium">
                    <span class="material-symbols-outlined text-[20px]">logout</span>
                    Sign Out
                </button>
            </div>
        </aside>
        <!-- Main Content -->
        <main class="flex-1 flex flex-col h-full overflow-hidden relative">
            <!-- Mobile Header (Visible only on small screens) -->
            <header class="md:hidden flex items-center justify-between p-4 glass-panel-heavy border-b border-white/5">
                <div class="flex items-center gap-3">
                    <div class="bg-center bg-no-repeat bg-cover rounded-full size-8" data-alt="Admin profile mobile"
                        style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDjuc8QtSwbC2qFwkuoVoVYoIY3Rv5BcF9DpF02z8MAEM-3KfqsBdcTEcyjzfrNJH4Edd_Ya52JeFPymoi7NEnbMgCD40GUp4TDhW_Xv5Ryy4NJy9IJvrA-6aaJqdneYmCcdxQpTVccdPf4WIp8ay1NDhy5di3zWo0njp7f8s3mlWG6XaccK9rC5MR-Nkw79Pd8_0PnbQ4_k0gCndDMsHUo_uUH1b8oqmrf_ZLTIPMm5JgqF80gGVmMUjWCqaincaqygIP-Wiiqh0A");'>
                    </div>
                    <span class="font-bold text-white">Admin Panel</span>
                </div>
                <button id="mobile-menu-btn" class="text-white p-2" onclick="toggleSidebar()">
                    <span class="material-symbols-outlined">menu</span>
                </button>
            </header>
            <!-- Scrollable Content Area -->
            <div class="flex-1 overflow-y-auto p-4 md:p-8 lg:p-10 scroll-smooth">
                <div class="max-w-7xl mx-auto space-y-8">
                    <!-- Page Header & Actions -->
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                        <div class="space-y-1">
                            <h2 class="text-3xl md:text-4xl font-extrabold text-white tracking-tight">User Management
                            </h2>
                            <p class="text-slate-400 text-base">Manage access, roles, and platform security.</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="showToast('Export functionality coming soon!', 'success')"
                                class="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-[#282d39] hover:bg-[#323846] text-white text-sm font-medium border border-white/10 transition-colors">
                                <span class="material-symbols-outlined text-[20px]">download</span>
                                Export
                            </button>
                        </div>
                    </div>
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        <!-- Card 1 -->
                        <div
                            class="glass-panel p-6 rounded-2xl flex flex-col justify-between relative overflow-hidden group">
                            <div
                                class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <span class="material-symbols-outlined text-[80px] text-primary">groups</span>
                            </div>
                            <div class="space-y-4 relative z-10">
                                <div class="flex items-center gap-2 text-slate-400 text-sm font-medium">
                                    <span class="material-symbols-outlined text-[20px]">person</span>
                                    Total Users
                                </div>
                                <div>
                                    <div id="total-users-count" class="text-3xl md:text-4xl font-bold text-white tracking-tight">0</div>
                                    <div class="flex items-center gap-1 text-[#0bda62] text-sm font-semibold mt-1">
                                        <span class="material-symbols-outlined text-[16px]">trending_up</span>
                                        <span>+5% this week</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Card 2 -->
                        <div
                            class="glass-panel p-6 rounded-2xl flex flex-col justify-between relative overflow-hidden group">
                            <div
                                class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <span class="material-symbols-outlined text-[80px] text-indigo-400">person_add</span>
                            </div>
                            <div class="space-y-4 relative z-10">
                                <div class="flex items-center gap-2 text-slate-400 text-sm font-medium">
                                    <span class="material-symbols-outlined text-[20px]">today</span>
                                    New Today
                                </div>
                                <div>
                                    <div id="new-users-count" class="text-3xl md:text-4xl font-bold text-white tracking-tight">--</div>
                                    <div class="flex items-center gap-1 text-[#0bda62] text-sm font-semibold mt-1">
                                        <span class="material-symbols-outlined text-[16px]">trending_up</span>
                                        <span>+12% vs yesterday</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Card 3 -->
                        <div
                            class="glass-panel p-6 rounded-2xl flex flex-col justify-between relative overflow-hidden group">
                            <div
                                class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <span class="material-symbols-outlined text-[80px] text-red-400">block</span>
                            </div>
                            <div class="space-y-4 relative z-10">
                                <div class="flex items-center gap-2 text-slate-400 text-sm font-medium">
                                    <span class="material-symbols-outlined text-[20px]">gavel</span>
                                    Banned Users
                                </div>
                                <div>
                                    <div id="banned-users-count" class="text-3xl md:text-4xl font-bold text-white tracking-tight">--</div>
                                    <div class="flex items-center gap-1 text-[#fa6538] text-sm font-semibold mt-1">
                                        <span class="material-symbols-outlined text-[16px]">trending_down</span>
                                        <span>-2% new bans</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Filters and Controls -->
                    <div
                        class="flex flex-col lg:flex-row gap-4 justify-between items-start lg:items-center glass-panel p-4 rounded-2xl">
                        <!-- Search -->
                        <div class="relative w-full lg:w-96 group">
                            <div
                                class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-slate-500 group-focus-within:text-primary transition-colors">
                                <span class="material-symbols-outlined">search</span>
                            </div>
                            <input id="searchInput"
                                class="block w-full p-3 pl-10 text-sm text-white bg-background-dark/50 border border-white/10 rounded-xl focus:ring-2 focus:ring-primary/50 focus:border-primary placeholder-slate-500 transition-all"
                                placeholder="Search users by name, email or ID..." type="text" />
                        </div>
                        <!-- Filter Chips -->
                        <div class="flex gap-2 overflow-x-auto pb-2 lg:pb-0 w-full lg:w-auto no-scrollbar">
                            <button id="btn-filter-all" onclick="setFilter('all')"
                                class="whitespace-nowrap px-4 py-2 rounded-lg bg-primary/20 text-primary border border-primary/20 text-sm font-semibold hover:bg-primary/30 transition-all">
                                All Users
                            </button>
                            <button id="btn-filter-admins" onclick="setFilter('admins')"
                                class="whitespace-nowrap px-4 py-2 rounded-lg bg-background-dark/30 text-slate-400 border border-white/10 text-sm font-medium hover:bg-white/5 hover:text-white transition-all">
                                Admins
                            </button>
                            <button id="btn-filter-moderators" onclick="setFilter('moderators')"
                                class="whitespace-nowrap px-4 py-2 rounded-lg bg-background-dark/30 text-slate-400 border border-white/10 text-sm font-medium hover:bg-white/5 hover:text-white transition-all">
                                Moderators
                            </button>
                            <button id="btn-filter-banned" onclick="setFilter('banned')"
                                class="whitespace-nowrap px-4 py-2 rounded-lg bg-background-dark/30 text-slate-400 border border-white/10 text-sm font-medium hover:bg-white/5 hover:text-white transition-all">
                                Banned
                            </button>
                            <button id="btn-filter-active" onclick="setFilter('active')"
                                class="whitespace-nowrap px-4 py-2 rounded-lg bg-background-dark/30 text-slate-400 border border-white/10 text-sm font-medium hover:bg-white/5 hover:text-white transition-all">
                                Active Users
                            </button>
                        </div>
                    </div>
                    <!-- Data Table -->
                    <div
                        class="glass-panel rounded-2xl overflow-hidden border border-white/5 shadow-2xl shadow-black/20">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr
                                        class="border-b border-white/5 bg-white/5 text-xs uppercase tracking-wider text-slate-400 font-semibold">
                                        <th class="px-6 py-4">
                                            <div class="flex items-center gap-1 cursor-pointer hover:text-white">
                                                User
                                                <span class="material-symbols-outlined text-[16px]">unfold_more</span>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4">Role</th>
                                        <th class="px-6 py-4">Status</th>
                                        <th class="px-6 py-4">Joined Date</th>
                                        <th class="px-6 py-4 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="user-table-body" class="text-sm divide-y divide-white/5">
                                    
                                </tbody>
                            </table>
                        </div>
                        <!-- Pagination Footer -->
                        <div id="pagination-footer" class="flex items-center justify-between p-4 border-t border-white/5 bg-white/[0.02]">
                            
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Role Management Modal -->
        <div id="role-modal" class="fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeRoleModal()"></div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-[#1e2330] border border-white/10 rounded-2xl shadow-2xl p-6">
                <h3 class="text-xl font-bold text-white mb-2">Manage Roles</h3>
                <p class="text-sm text-slate-400 mb-6">Select roles to assign to this user.</p>
                
                <form id="role-form" onsubmit="submitRoles(event)">
                    <input type="hidden" id="role-user-id">
                    <div id="role-list" class="space-y-3 mb-6 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Roles injected here -->
                    </div>
                    
                    <div class="flex gap-3 justify-end">
                        <button type="button" onclick="closeRoleModal()" class="px-4 py-2 rounded-xl text-slate-400 hover:bg-white/5 transition-colors text-sm font-semibold">Cancel</button>
                        <button type="submit" class="px-4 py-2 rounded-xl bg-primary text-white text-sm font-bold hover:bg-blue-600 transition-colors shadow-lg shadow-blue-500/20">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>

</html>