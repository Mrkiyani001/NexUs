<!DOCTYPE html>
<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>SocialApp - User Profile</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#215bed",
                        "background-light": "#f6f6f8",
                        "background-dark": "#111318",
                        "card-dark": "#1c1f27",
                        "card-glass": "rgba(28, 31, 39, 0.7)",
                        "secondary-text": "#9da5b9"
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "2xl": "2rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: #282d39; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3e4556; 
        }
        .glass-panel {
            background: rgba(28, 31, 39, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .nav-item {
            position: relative;
        }
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: #215bed;
            transition: width 0.3s ease;
        }
        .nav-item:hover::after {
            width: 100%;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white min-h-screen flex flex-col overflow-x-hidden selection:bg-primary/30">
<header class="sticky top-0 z-50 glass-panel border-b border-white/5">
<div class="max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-3 flex items-center justify-between whitespace-nowrap">
<div class="flex items-center gap-10">
<a class="flex items-center gap-3 text-white group" href="homefeed-dashboard.html">
<div class="size-9 text-primary group-hover:scale-110 transition-transform duration-300">
<svg class="w-full h-full drop-shadow-[0_0_10px_rgba(33,91,237,0.4)]" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M8.57829 8.57829C5.52816 11.6284 3.451 15.5145 2.60947 19.7452C1.76794 23.9758 2.19984 28.361 3.85056 32.3462C5.50128 36.3314 8.29667 39.7376 11.8832 42.134C15.4698 44.5305 19.6865 45.8096 24 45.8096C28.3135 45.8096 32.5302 44.5305 36.1168 42.134C39.7033 39.7375 42.4987 36.3314 44.1494 32.3462C45.8002 28.361 46.2321 23.9758 45.3905 19.7452C44.549 15.5145 42.4718 11.6284 39.4217 8.57829L24 24L8.57829 8.57829Z" fill="currentColor"></path>
</svg>
</div>
<h2 class="text-white text-xl font-bold leading-tight tracking-tight">SocialApp</h2>
</a>
<nav class="hidden md:flex items-center gap-8">
<a class="nav-item text-secondary-text hover:text-white transition-colors text-sm font-medium leading-normal py-1" href="homefeed-dashboard.html">Home</a>
<a class="nav-item text-secondary-text hover:text-white transition-colors text-sm font-medium leading-normal py-1" href="#">Explore</a>
<a class="nav-item text-secondary-text hover:text-white transition-colors text-sm font-medium leading-normal py-1" href="#">Notifications</a>
<a class="nav-item text-secondary-text hover:text-white transition-colors text-sm font-medium leading-normal py-1" href="#">Messages</a>
</nav>
</div>
<div class="flex items-center gap-4 md:gap-6">
    <button id="logout-btn" class="text-secondary-text hover:text-red-400 transition-colors" title="Logout">
        <span class="material-symbols-outlined">logout</span>
    </button>
<div class="hidden lg:block relative group w-64">
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-secondary-text group-focus-within:text-primary transition-colors">
<span class="material-symbols-outlined text-[20px]">search</span>
</div>
<input class="block w-full pl-10 pr-3 py-2.5 bg-white/5 border border-white/5 rounded-xl text-sm text-white placeholder-secondary-text focus:outline-none focus:bg-white/10 focus:ring-1 focus:ring-primary/50 transition-all backdrop-blur-sm" placeholder="Search topics..." type="text"/>
</div>
<div class="flex items-center gap-4">
<button class="text-secondary-text hover:text-white transition-colors lg:hidden">
<span class="material-symbols-outlined">search</span>
</button>
<button class="relative group" onclick="window.location.href='profile.html'">
<div id="header-user-avatar" class="bg-center bg-no-repeat bg-cover rounded-full size-10 ring-2 ring-white/10 group-hover:ring-primary transition-all shadow-lg" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAN-wu7trswsWEqgveVe2SdBY8dI4SEhN-omBDe6GLx3UrQWmfOXxK25CwIk6ggQVcHr2daoM721j0qvnnCbDgTryzKxnsHzVDV13KaJh1Su7Pd5KxWTVZuKqKoVGPoDZdiYM7tLxOOCsqsks8dGReZrfig4F_jgo8jdRWqNXWCBcpHwgkvgLJVLSmb4hMelWtQL6ysr2XGoF7AiFbNvkDi2qXpy2tXQhJF4iqPmVHE8CYcwsoyCwA6bfxlvYziX6RFZa6-PPNALkg");'>
</div>
<div class="absolute bottom-0 right-0 size-3 bg-green-500 rounded-full border-2 border-[#1c1f27]"></div>
</button>
</div>
</div>
</div>
</header>
<main class="flex-1 relative flex justify-center py-8 px-4 md:px-0">
<div class="fixed top-[20%] left-[10%] w-[500px] h-[500px] bg-primary/20 rounded-full blur-[120px] pointer-events-none z-0"></div>
<div class="fixed bottom-[10%] right-[10%] w-[400px] h-[400px] bg-purple-500/10 rounded-full blur-[100px] pointer-events-none z-0"></div>
<div class="relative w-full max-w-[840px] z-10 flex flex-col gap-6">
<div class="flex items-center gap-2 text-secondary-text hover:text-white cursor-pointer transition-colors px-2" onclick="window.location.href='homefeed-dashboard.html'">
<span class="material-symbols-outlined text-sm">arrow_back</span>
<span class="text-sm font-medium">Back to Feed</span>
</div>
<div class="glass-panel rounded-2xl overflow-hidden animate-fade-in shadow-2xl">
<div class="h-56 w-full bg-cover bg-center relative group" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDFVqtBcwKBfj_yPQQ67BKYVl7gR8kZu-5lS8sa7vX1xq3mdfaTcH-NY4MsQjiKtkEAQgrPoY0c9AZsDQFKbC75Y6rDriMq8UCZ6nH_proIkcXy3dHq-jhOulHU0Q0p2L1PYJMn38KdYt4R1THsRxltmRRvV3hOi5ls2TqDLzLjFQpBwMPm8z3AYDe7fHHxqKjl3m0-JIkyfhRS2DFehFtrTzc-dpP-CIUfhAXaaICAxJsPRTaPESZBoa6boSvtrYHfyG23oCif4-g");'>
<div class="absolute inset-0 bg-gradient-to-t from-[#14161c] via-transparent to-transparent opacity-80"></div>
<button class="absolute top-4 right-4 bg-black/40 hover:bg-black/60 text-white p-2 rounded-full backdrop-blur-md opacity-0 group-hover:opacity-100 transition-all duration-300">
<span class="material-symbols-outlined text-[20px]">photo_camera</span>
</button>
</div>
<div class="px-8 pb-0 relative">
<div class="flex flex-col md:flex-row md:justify-between md:items-end -mt-16 mb-6 gap-4">
<div class="relative group">
<div class="size-32 md:size-36 rounded-full border-[6px] border-[#181a20] bg-[#181a20] p-1 relative z-10 shadow-xl">
<div id="profile-avatar-display" class="w-full h-full rounded-full bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCbegY9HzjUTliW_EGzSG4LhzC9zkYVReVPDnPICJxZxJ7z2noRqYsauK82k2uCGOnT3SAp02-WzsTGlxefUvLKYT2XT2MOHwJegWEBZeUr6TjIt7AZaOCqtEaH4Pc13XkNwDu89sl0S3Nh6DrRlXp5gjRyemXke1TqHIueqUqX3mFCyz7EVaQNjRS88nHpm70KXyqKEs5qewTVToumHPO5Qkaa-dqydQW6GKrBjbRHgQ-SgszkCPu0VfBaZQ9ZIWuJjIHKnGy2nec");'></div>
</div>
<div class="absolute bottom-4 right-2 md:right-4 z-20 bg-green-500 size-5 rounded-full border-4 border-[#181a20]" title="Online"></div>
</div>
<div class="flex gap-3 mb-2 justify-end" id="profile-actions">
<!-- Injected via JS -->
</div>
</div>
<div class="mb-8">
<div class="flex items-center gap-2 mb-1">
<h1 id="profile-name" class="text-3xl font-bold text-white tracking-tight">Loading...</h1>
<span class="material-symbols-outlined text-blue-400 text-[24px]" title="Verified">verified</span>
</div>
<div id="profile-handle" class="text-secondary-text mb-4 font-medium">@username</div>
<p id="profile-bio" class="text-slate-200 text-base leading-relaxed max-w-2xl font-light">
                            Loading...
                        </p>
<div class="flex flex-wrap gap-4 md:gap-6 mt-5 text-sm text-secondary-text font-medium">
<div class="flex items-center gap-1.5">
<span class="material-symbols-outlined text-[18px] text-primary">location_on</span>
                                Location
                            </div>
<div class="flex items-center gap-1.5 hover:text-white transition-colors cursor-pointer">
<span class="material-symbols-outlined text-[18px] text-primary">link</span>
<a class="hover:underline" href="#">website.com</a>
</div>
<div class="flex items-center gap-1.5">
<span class="material-symbols-outlined text-[18px] text-primary">calendar_month</span>
                                Joined Recently
                            </div>
</div>
</div>
<div class="flex gap-8 md:gap-12 border-t border-white/5 pt-6 pb-8">
<div class="flex flex-col gap-1 cursor-pointer group">
<span id="followers-count" class="text-white font-bold text-xl group-hover:text-primary transition-colors">0</span>
<span class="text-secondary-text text-xs uppercase tracking-wider font-bold group-hover:text-white transition-colors">Followers</span>
</div>
<div class="flex flex-col gap-1 cursor-pointer group">
<span id="following-count" class="text-white font-bold text-xl group-hover:text-primary transition-colors">0</span>
<span class="text-secondary-text text-xs uppercase tracking-wider font-bold group-hover:text-white transition-colors">Following</span>
</div>
<div class="flex flex-col gap-1 cursor-pointer group">
<span id="posts-count" class="text-white font-bold text-xl group-hover:text-primary transition-colors">0</span>
<span class="text-secondary-text text-xs uppercase tracking-wider font-bold group-hover:text-white transition-colors">Posts</span>
</div>
</div>
</div>
<div class="px-8 flex gap-8 border-t border-white/5 bg-white/[0.02]">
<button class="py-4 text-sm font-bold text-primary border-b-2 border-primary relative">
                        My Posts
                    </button>
<button class="py-4 text-sm font-medium text-secondary-text hover:text-white transition-colors relative group">
                        Media
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-white/20 scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></span>
</button>
<button class="py-4 text-sm font-medium text-secondary-text hover:text-white transition-colors relative group">
                        Liked
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-white/20 scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></span>
</button>
</div>
</div>
<div id="user-posts-container" class="space-y-6">
    <div class="flex justify-center py-12">
        <span class="material-symbols-outlined animate-spin text-primary text-4xl">progress_activity</span>
    </div>
</div>
<div class="h-10 text-center text-secondary-text text-sm opacity-50 py-4">End of posts</div>
</div>
</main>
<script>
    const API_BASE_URL = 'http://127.0.0.1:8000/api';
    const PUBLIC_URL = 'http://127.0.0.1:8000';

    const token = localStorage.getItem('auth_token');
    const currentUserData = JSON.parse(localStorage.getItem('user_data') || '{}');
    const urlParams = new URLSearchParams(window.location.search);
    const targetUserId = urlParams.get('id') || currentUserData.id;

    if (!token) window.location.href = 'login.html';

    document.getElementById('logout-btn').addEventListener('click', () => {
        localStorage.removeItem('auth_token');
        localStorage.removeItem('user_data');
        window.location.href = 'login.html';
    });

    if (currentUserData.name) {
        const avatar = `url('https://ui-avatars.com/api/?name=${encodeURIComponent(currentUserData.name)}&background=random')`;
        document.getElementById('header-user-avatar').style.backgroundImage = avatar;
    }

    async function loadProfile() {
        try {
            const response = await fetch(`${API_BASE_URL}/view`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ id: targetUserId })
            });
            const data = await response.json();

            if (data.success) {
                renderProfile(data.data);
                loadUserPosts(data.data.id);
            } else {
                alert('User not found');
            }
        } catch (e) {
            console.error(e);
        }
    }

    function renderProfile(user) {
        document.getElementById('profile-name').textContent = user.name;
        document.getElementById('profile-handle').textContent = '@user' + user.id;
        document.getElementById('profile-bio').textContent = user.profile?.bio || 'No bio provided.';
        document.getElementById('followers-count').textContent = user.followers_count || 0;
        document.getElementById('following-count').textContent = user.following_count || 0;
        document.getElementById('posts-count').textContent = 0; // Will be updated by loadPosts if API supports count, else kept 0

        const avatarUrl = `url('https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=random')`;
        document.getElementById('profile-avatar-display').style.backgroundImage = avatarUrl;

        const actionsContainer = document.getElementById('profile-actions');
        actionsContainer.innerHTML = '';

        if (user.id == currentUserData.id) {
            const editBtn = document.createElement('button');
            editBtn.className = "px-6 py-2.5 rounded-xl bg-white/5 border border-white/10 text-white font-semibold text-sm hover:bg-white/10 hover:border-white/20 transition-all flex items-center gap-2";
            editBtn.innerHTML = '<span class="material-symbols-outlined text-[20px]">edit</span> Edit Profile';
            actionsContainer.appendChild(editBtn);
        } else {
            const msgBtn = document.createElement('button');
            msgBtn.className = "px-4 py-2.5 rounded-xl bg-white/5 border border-white/10 text-white font-semibold text-sm hover:bg-white/10 hover:border-white/20 transition-all flex items-center gap-2 shadow-lg shadow-black/20";
            msgBtn.innerHTML = '<span class="material-symbols-outlined text-[20px]">mail</span> Message';
            actionsContainer.appendChild(msgBtn);
            
            checkFollowStatus(user.id);
        }
    }

    async function checkFollowStatus(targetId) {
        try {
            const response = await fetch(`${API_BASE_URL}/fetch_following`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ user_id: currentUserData.id })
            });
            const data = await response.json();
            const isFollowing = data.success && data.data.some(u => u.id == targetId);
            renderFollowButton(targetId, isFollowing);
        } catch (e) { console.error(e); }
    }

    function renderFollowButton(targetId, isFollowing) {
        const container = document.getElementById('profile-actions');
        const existingBtn = document.getElementById('follow-btn');
        if(existingBtn) existingBtn.remove();

        const btn = document.createElement('button');
        btn.id = 'follow-btn';
        if (isFollowing) {
            btn.className = "px-6 py-2.5 rounded-xl bg-white/10 text-white font-bold text-sm hover:bg-red-500/20 hover:text-red-400 transition-all border border-white/20 flex items-center gap-2";
            btn.innerHTML = '<span class="material-symbols-outlined text-[20px]">person_remove</span> Unfollow';
            btn.onclick = () => toggleFollow(targetId, 'unfollow');
        } else {
            btn.className = "px-6 py-2.5 rounded-xl bg-primary text-white font-bold text-sm hover:bg-blue-600 transition-all shadow-lg shadow-blue-500/20 flex items-center gap-2 transform hover:-translate-y-0.5";
            btn.innerHTML = '<span class="material-symbols-outlined text-[20px]">person_add</span> Follow';
            btn.onclick = () => toggleFollow(targetId, 'follow');
        }
        container.appendChild(btn);
    }

    async function toggleFollow(targetId, action) {
        try {
             const response = await fetch(`${API_BASE_URL}/${action}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ user_id: targetId })
            });
            const data = await response.json();
            if (data.success) {
                renderFollowButton(targetId, action === 'follow');
                loadProfile(); 
            }
        } catch(e) { console.error(e); }
    }

    async function loadUserPosts(userId) {
        try {
            const response = await fetch(`${API_BASE_URL}/get_posts_by_user?limit=10`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ user_id: userId })
            });
            const data = await response.json();
            const container = document.getElementById('user-posts-container');
            container.innerHTML = '';

            if (data.success && data.data.items.length > 0) {
                 document.getElementById('posts-count').textContent = data.data.pagination.total;
                 data.data.items.forEach(post => {
                     container.insertAdjacentHTML('beforeend', createPostHTML(post));
                 });
            } else {
                container.innerHTML = '<p class="text-center text-slate-500 py-8">No posts yet.</p>';
            }
        } catch(e) { console.error(e); }
    }

    function createPostHTML(post) {
        const user = post.user || { name: 'Unknown', id: 0 };
        const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=random`;
        const timeAgo = new Date(post.created_at).toLocaleDateString();

        let attachmentsHTML = '';
         if (post.attachments && post.attachments.length > 0) {
            const files = Array.isArray(post.attachments) ? post.attachments : [];
            if (files.length > 0) {
                 attachmentsHTML = `<div class="mt-4 rounded-xl overflow-hidden border border-white/10 h-64 relative group cursor-pointer">`;
                 const file = files[0];
                 let src = '';
                 if (typeof file === 'object' && file.file_path) src = `${PUBLIC_URL}/${file.file_path}`;
                 else if (typeof file === 'string') src = `${PUBLIC_URL}/posts/${file}`;
                 
                 if(src) attachmentsHTML += `<div class="w-full h-full bg-cover bg-center" style="background-image: url('${src}')"></div>`;
                 attachmentsHTML += `</div>`;
            }
        }

        return `
        <article class="glass-panel rounded-2xl shadow-xl overflow-hidden p-6 cursor-pointer hover:bg-white/5 transition-colors" onclick="window.location.href='post-detail-veiw.html?id=${post.id}'">
            <div class="flex gap-4">
                <div class="size-10 rounded-full bg-cover bg-center shrink-0 border border-white/10" style='background-image: url("${avatarUrl}");'></div>
                <div class="flex-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-white font-bold text-sm">${user.name}</h3>
                            <span class="text-secondary-text text-xs">${timeAgo}</span>
                        </div>
                    </div>
                    <p class="text-slate-200 mt-2 text-sm leading-relaxed">${post.body}</p>
                    ${attachmentsHTML}
                    <div class="flex gap-6 mt-4 border-t border-white/5 pt-3">
                         <div class="flex items-center gap-2 text-secondary-text text-xs font-semibold">
                             <span class="material-symbols-outlined text-[18px]">favorite</span> Like
                         </div>
                         <div class="flex items-center gap-2 text-secondary-text text-xs font-semibold">
                             <span class="material-symbols-outlined text-[18px]">chat_bubble</span> Comment
                         </div>
                    </div>
                </div>
            </div>
        </article>`;
    }

    loadProfile();
</script>
</body></html>