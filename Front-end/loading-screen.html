<!DOCTYPE html>

<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Social App - Loading State</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#215bed",
                        "background-light": "#f6f6f8",
                        "background-dark": "#101522",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px" },
                    animation: {
                        shimmer: 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' },
                        }
                    }
                },
            },
        }
    </script>
    <style>
        /* Glassmorphism utilities */
        .glass-panel {
            background: rgba(28, 31, 39, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-panel-lighter {
            background: rgba(40, 45, 57, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Shimmer Effect for Skeletons */
        .skeleton {
            background: #1c1f27;
            background-image: linear-gradient(to right, #1c1f27 0%, #2a313f 20%, #1c1f27 40%, #1c1f27 100%);
            background-repeat: no-repeat;
            background-size: 2000px 100%;
            animation-name: shimmer;
            animation-duration: 1.5s;
            animation-fill-mode: forwards;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
        }

        /* Dark mode enhancements for skeletons to match the requested "cool dark tone" */
        .dark .skeleton {
            background: #1c1f27;
            background-image: linear-gradient(to right, #1c1f27 0%, rgba(33, 91, 237, 0.15) 20%, #1c1f27 40%, #1c1f27 100%);
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-white min-h-screen flex items-center justify-center overflow-hidden">
    <div class="relative flex flex-col items-center justify-center gap-6 z-10">
        <!-- Premium Spinner -->
        <div class="relative w-20 h-20">
            <!-- Outer Ring -->
            <div class="absolute inset-0 border-4 border-white/5 rounded-full blur-[1px]"></div>
            <!-- Spinning Gradient Ring -->
            <div class="absolute inset-0 border-4 border-primary/50 rounded-full border-t-primary border-r-transparent border-b-transparent border-l-transparent animate-spin"></div>
            <!-- Inner Glow -->
            <div class="absolute inset-0 bg-primary/20 blur-xl rounded-full animate-pulse"></div>
            <!-- Logo/Icon Center (Optional) -->
             <div class="absolute inset-0 flex items-center justify-center">
                <span class="material-symbols-outlined text-3xl text-white/50 animate-pulse">grid_view</span>
            </div>
        </div>

        <!-- Text -->
        <div class="flex flex-col items-center gap-2">
            <h2 class="text-xl font-bold tracking-wider text-white">SOCIAL APP</h2>
            <p class="text-sm text-slate-400 font-medium animate-pulse">Preparing your feed...</p>
        </div>
    </div>

    <!-- Background Decoration -->
    <div class="absolute inset-0 z-0 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-primary/10 rounded-full blur-[120px] animate-pulse"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-blue-600/10 rounded-full blur-[120px] animate-pulse" style="animation-delay: 1s;"></div>
    </div>
</body>
<script>
    const API_BASE_URL = 'http://127.0.0.1:8000/api';

    document.addEventListener('DOMContentLoaded', async () => {
        // Check for authentication token
        const token = localStorage.getItem('auth_token');

        if (!token) {
            window.location.href = 'login.html';
            return;
        }

        // Start minimum wait timer (2 seconds)
        const waitPromise = new Promise(resolve => setTimeout(resolve, 2000));

        // Start data fetch
        const fetchPromise = fetch(`${API_BASE_URL}/get_all_posts?limit=50`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Accept': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem('cached_posts', JSON.stringify(data));
                }
            })
            .catch(err => console.error('Pre-fetch failed', err));

        // Wait for both (or at least the timer)
        // We want to ensure at least 2 seconds passed for the visual effect
        // If fetch takes longer, we might want to wait a bit more or just let the dashboard handle it?
        // Let's await both to ensure data IS ready, but cap the fetch wait?
        // For now, simpler: await both.

        await Promise.all([waitPromise, fetchPromise]);

        window.location.href = 'homefeed-dashboard.html';
    });
</script>

</html>